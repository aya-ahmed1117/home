
<?php
include ("pages.php");?>
<link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png">
    <link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
   
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css" rel="stylesheet" />

 <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css"> 

<link rel="stylesheet" href="path/to/pe-icon-7-stroke/css/pe-icon-7-stroke.css">
<!-- Optional - Adds useful class to manipulate icon font display -->
<link rel="stylesheet" href="path/to/pe-icon-7-stroke/css/helper.css">
<link rel="stylesheet" href="assets/css/cs-skin-elastic.css">

<br>
<br>

<div class="content">
<style type="text/css">
 .stat-icon{
  font-size: 60px;
  }
  .flat-color-1 {
    color: #00c292;   
}
.flat-color-2 {
color: #6610f2;
  }


</style>
<!--
  <span class="pe-7s-map-marker"></span> pe-7s-map-marker
<i class="pe-7s-home" style="color: green;font-size: 50px"></i> pe-7s-home
             Animated -->
            <div class="animated fadeIn">

                <!-- Widgets  -->
                <div class="row">
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                              <a href="signing machine.php">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-1">
                                        <i class="pe-7s-cash"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text">$<span class="count">23569</span></div>
                                            <div class="stat-heading">Revenue</div>
                                        </div>
                                    </div>
                                </div>
                              </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-2">
                                        <i class="pe-7s-cart"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">3435</span></div>
                                            <div class="stat-heading">Sales</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-3">
                                        <i class="pe-7s-browser"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">349</span></div>
                                            <div class="stat-heading">Templates</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-4">
                                        <i class="pe-7s-users"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">2986</span></div>
                                            <div class="stat-heading" >&#xe6ac</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Widgets -->

                <!-- To Do and Live Chat -->
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title box-title">To Do List</h4>
                                <div class="card-content">
                                    <div class="todo-list">
                                        <div class="tdl-holder">
                                            <div class="tdl-content">
                                                <ul>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox"><i class="check-box"></i><span>Conveniently fabricate interactive technology for ....</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox"><i class="check-box"></i><span>Creating component page</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Follow back those who follow you</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Design One page theme</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>

                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Creating component page</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div> <!-- /.todo-list -->
                                </div>
                            </div> <!-- /.card-body -->
                        </div><!-- /.card -->
                    </div>

<div class="content">
            <div class="animated">

                <div class="card">
                    <div class="card-header">
                        <i class="mr-2 fa fa-align-justify"></i>
                        <strong class="card-title" v-if="headerText">Modals</strong>
                    </div>
                    <div class="card-body">

                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary mb-1" data-toggle="modal" data-target="#smallmodal">
                          Small
                      </button>

                      <button type="button" class="btn btn-secondary mb-1" data-toggle="modal" data-target="#mediumModal">
                          Medium
                      </button>
                      <button type="button" class="btn btn-success mb-1" data-toggle="modal" data-target="#largeModal">
                          Large
                      </button>
                      <button type="button" class="btn btn-info mb-1" data-toggle="modal" data-target="#scrollmodal">
                          Scrolling
                      </button>
                      <button type="button" class="btn btn-danger mb-1" data-toggle="modal" data-target="#staticModal">
                          Static
                      </button>

                  </div>
              </div>




              <div class="modal fade" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" aria-hidden="true" style="display: none;">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="smallmodalLabel">Small Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                There are three species of zebras: the plains zebra, the mountain zebra and the Grévy's zebra. The plains zebra
                                and the mountain zebra belong to the subgenus Hippotigris, but Grévy's zebra is the sole species of subgenus
                                Dolichohippus. The latter resembles an ass, to which it is closely related, while the former two are more
                                horse-like. All three belong to the genus Equus, along with other living equids.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="mediumModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true" style="display: none;">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="mediumModalLabel">Medium Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                There are three species of zebras: the plains zebra, the mountain zebra and the Grévy's zebra. The plains zebra
                                and the mountain zebra belong to the subgenus Hippotigris, but Grévy's zebra is the sole species of subgenus
                                Dolichohippus. The latter resembles an ass, to which it is closely related, while the former two are more
                                horse-like. All three belong to the genus Equus, along with other living equids.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="largeModal" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="largeModalLabel">Large Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                There are three species of zebras: the plains zebra, the mountain zebra and the Grévy's zebra. The plains 
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="scrollmodal" tabindex="-1" role="dialog" aria-labelledby="scrollmodalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="scrollmodalLabel">Scrolling Long Content Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                                    Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.<br>

                                Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.<br>

                                Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.<br>

                                Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.<br>

                                Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.<br>

                                Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.<br>

                                Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.<br>

                                Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.<br>

                                Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.<br>

                                Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.<br>

                                Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.<br>

                                Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.<br>

                                Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Confirm</button>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="staticModal" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true" style="display: none;">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticModalLabel">Static Modal</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                               This is a static modal, backdrop click will not close it.
                           </p>
                       </div>
                       <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Confirm</button>
                    </div>
                </div>
            </div>
        </div>



    </div><!-- .animated -->
</div>


    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot-spline@0.0.1/js/jquery.flot.spline.min.js"></script>
    <!-- local -->
    <script src="assets2/js/widgets.js"></script>
       <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
    <script src="assets/js/main.js"></script>
</body>

/////////////// old leaves 27/9/2021

<?php
include ("pages.php");

     $self = $_SESSION['id'];
      $role_id = $_SESSION['role_id'];
      $s_username = $_SESSION['username'];
      ?>
    <title>Create Leaves</title>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap2.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/my_table.css">

</head>
 
<style> 

tr:nth-child(even) {
  background-color: lightgray;
}


.overlay:before {
  content:"";
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: block;
  background: rgba(0, 0, 0, 0.6);
  position: fixed;
  z-index: 9;
}
.overlay .popup {
  background: #fff;
  border-radius: 5px;
  width: 30%;
  position: fixed;
  top: 0;
  left: 35%;
  padding: 25px;
  margin: 100px auto;
  z-index: 10;
  -webkit-transition: all 0.6s ease-in-out;
  -moz-transition: all 0.6s ease-in-out;
  transition: all 0.6s ease-in-out;
}
.overlay:target .popup {
    top: 100%;
    left: -50%;
}

@media screen and (max-width: 768px){
  .box{
    width: 70%;
  }
  .overlay .popup{
    width: 70%;
    left: 15%;
  }
}

.deleteMeetingClose {
    font-size: 1.5em;
    cursor: pointer;
    position: absolute;
    right: 10px;
    top: 5px;
}
</style> <center>
  
<div class="col-md-8">
        <aside class="profile-nav alt" style="border:1px solid rgba(0,0,0,.125);
        border-radius: 20px 20px 20px 20px;">
            <div class="card-header user-header alt bg-light"
            style="border-radius: 20px 20px 0 0 ;">
            <div class="media">
            <div class="media-body">
              <h2 class="text-dark display-12" >Create Leaves</h2>
              <p style="color:lightgray;">Welcome : <?php echo $_SESSION["username"];?></p>
              </div>
          </div>
      </div>
       <p style="background-color:#55608f;font-weight:bold;font-size:16px;
       color:white;">here you can chosse you leave type and duration from to and add your notes and attachement if needed </p>
  </aside>
</div>
</center>
<section class="border p-4 d-flex justify-content-center mb-4">

<form method="POST" onsubmit="return compare()" 
 enctype="multipart/form-data">
  <div >
 <!--div class="form-control"-->

 <div class="input-group mb-3" id="upload"> 
  <input type="file" name="fileToUpload" class="form-control" id="fileToUpload" />
  <span class="input-group-text">Upload</span>
   <!--label >Select image to upload (it must be less than 1 mega):</label-->   

</div>

   <div class="input-group md-2">
  <span class="input-group-text" id="basic-addon1">Start Date</span>
  <input type="date" class="form-control" placeholder="From Date" aria-label="From Date" name="adate" id="adate"
    aria-describedby="basic-addon1"/>
</div>

      <br> 
<div class="input-group md-2">
  <span class="input-group-text" id="basic-addon1">End date</span>
  <input type="date" class="form-control" placeholder="To Date" aria-label="To Date" name="bdate" id="bdate"
    aria-describedby="basic-addon1"/>
</div>

 <br>
<div class="input-group md-2" id="FromTimeDiv">
  <span class="input-group-text" id="basic-addon1">From Time</span>
  <input type="time" class="form-control"
  aria-label="To Date" 
  name="starttime"  id="starttime" placeholder="Enter start time"
    aria-describedby="basic-addon1"/>
</div>
 
<br>
<div class="input-group" id="ToTimeDiv">
  <span class="input-group-text" id="basic-addon1">To Time</span>
  <input type="time" class="form-control"aria-label="From Time" 
  name="endtime"  id="endtime" placeholder="Enter end time"
    aria-describedby="basic-addon1"/>
</div>

<br>

<div  class="input-group md-2" id="inputGroupSelect01div">
  <span class="input-group-text" id="basic-addon1">Choose</span>
  <select id="inputGroupSelect01" class="form-control sType" name="type"    required>
    <option action="none" value="0" selected>Leave Type...</option>
    <option value="Annual Leave">Annual Leave</option>
    <option value="Sick Leave">Sick Leave</option>

    <?php
  $DBhost = "172.29.29.76";
  $DBuser = "Seniors";
  $DBpass = "123456789";
  $DBname = "Employess_DB";
  
  $connectionInfo = array( "Database"=>"Employess_DB" , "UID"=>"Seniors" , "PWD"=>"123456789");
  $con1 = sqlsrv_connect($DBhost, $connectionInfo);

  //$unit = $_SESSION['Unit_Name'];
$checkme = sqlsrv_query( $con1 ,"SELECT [Unit]
  FROM [Employess_DB].[dbo].[tbl_Personal_info] where username = '$s_username'");
  $output = sqlsrv_fetch_array($checkme );
   $Unit_Name = $output['Unit'];
//echo $Unit_Name .'hear';
if ($Unit_Name <> 12 ){
  ?>
    <option value="Instead of(HR)">Instead of(HR)</option>
  <?php }
  ?>
    <option value="Compassionate Leave">Compassionate Leave</option>
    <option value="Maternity Leave">Maternity Leave</option>
    <option value="Pilgrimage Leave">Pilgrimage Leave</option>
    <option value="Official Mission">Official Mission</option>
    <option value="Paternity Leave">Paternity Leave</option>
    <option value="Permission">Permission</option>
    <option value="Unpaid Leave">Unpaid Leave</option>
    <option value="Maternity on duty leave">Maternity on duty leave</option>
  </select>

</div>
   <br>
<div class="input-group" >
  <span class="input-group-text" id="basic-addon1">Counting</span>
  <input name="count" id="countDays" placeholder="calculate days" class="nav-link form-control disabled"
    aria-describedby="basic-addon1" required/>
    <button onclick="event.preventDefault();myfunc()" 
  style="width: 20%;" class="btn btn-warning">Count</button>
</div>

<br>
  
<br>
 <div class="form-outline">
  <label class="input-group-text" for="textAreaExample">Notes..</label>
  <textarea class="form-control notes" name="notes" id="textAreaExample" rows="4"></textarea>
</div>
<br>

<input type="submit" class="btn btn-primary submit" onclick="compare()" name="send" value="create leave"style="width:30%;" />

<br>
<?php
date_default_timezone_set('Africa/Cairo');

  $DBhost = "172.29.29.76";
  $DBuser = "Seniors";
  $DBpass = "123456789";
  $DBname = "Employess_DB";
  
  $connectionInfo = array( "Database"=>"Employess_DB" , "UID"=>"Seniors" , "PWD"=>"123456789");
  $con1 = sqlsrv_connect($DBhost, $connectionInfo);
sqlsrv_query( $con1 , "SET NAMES 'utf8'"); 
sqlsrv_query( $con1 ,'SET CHARACTER SET utf8' );

   $s_username = $_SESSION['username'];


 $newannual  = sqlsrv_query($con1,"SELECT Annuel_days
  from Annuel_cal
  where Annuel_cal.UserName = '$s_username'");

   $outputs_query = sqlsrv_fetch_array($newannual);
      $Annuel_days = $outputs_query['Annuel_days'];
      

if(isset($_POST['send'])){
if(isset($_FILES['fileToUpload'])){

$target_dir = "uploads/";
$target_file =  strtotime("now");
$image= $_FILES["fileToUpload"];
$uploadOk = 1;
$imageFileType = strtolower(pathinfo($_FILES['fileToUpload']["name"],PATHINFO_EXTENSION));

$target_dir = "uploads/";
$target_file =  strtolower($target_dir.basename(strtotime("now").'.'.$imageFileType));

//echo $target_file.'-----2----<br/>' ;

  $s_username = $_SESSION['username'];
  $engineer_id = $_SESSION['id'];
  if(isset($_POST['adate'])){$adate = $_POST['adate'];}
  if(isset($_POST['bdate'])){$bdate = $_POST['bdate'];}
  if(isset($_POST['starttime'])){$starttime = $_POST['starttime'];}
  if(isset($_POST['endtime'])){$endtime= $_POST['endtime'];}
  if(isset($_POST['type'])){$type = $_POST['type'];}
  //if(isset($_POST['notes'])){$notes = $_POST['notes'];}

 $escaped = $_POST['notes'];
 $notes = str_replace("'", "''", $escaped);

  if(isset($_POST['count'])){$interval = $_POST['count'];}
$status='pending';
$sqltime = date ("Y-m-d H:i:s");
//[creation_time]

$CurrentYear =  date("Y");
$NextYear = date("Y", strtotime('+1 month'));

$CurrentMonth = date("m");
$NextMonth = date("m", strtotime('+1 month'));
//fffffffffffffffffffffffffffffff
if($type == 'Annual Leave')
{
 $s_username = $_SESSION['username'];
 $engineer_id = $_SESSION['id'];
$first_query = sqlsrv_query( $con ,"SELECT sum([count]) as countLeaves FROM leaves WHERE ( status  = 'E-workforce and senior approve' or status = 'PENDING') AND [username] = '". $s_username."' and YEAR([adate]) = ".$CurrentYear." and YEAR([bdate]) = ".$CurrentYear." and [type] = 'Annual Leave'");
//php -> output data from mysqli
  while($output_query = sqlsrv_fetch_array($first_query)){
    $countLeaves = $output_query["countLeaves"];
   
  }
   // if less than 21 

  if(($countLeaves+$interval  > $Annuel_days) && ($type == 'Annual Leave') && ($_SESSION['username'] !== 'x_test')) {
  echo '
<br>
<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       Your Operation Couldn`t be completed because you exceed the allowed '.$Annuel_days.' annual days 
    </div>
  </div>
</div>
';
  }

  elseif($interval > 0)
  {
    //sqlsrv_query( $con ,
    $insert_query = sqlsrv_query( $con ,"INSERT INTO leaves ([username] , [engineer_id] , [adate] , [bdate] ,[starttime] , [endtime] , [type] , [notes] , [count] , [status] , [creation_time]) VALUES ('$s_username','$engineer_id' , '$adate' , '$bdate' , '$starttime' , '$endtime' , '$type', '$notes' , '$interval' , '$status' , '$sqltime' )");
    $total =($countLeaves+$interval);

     //echo ($elba2y = $Annuel_days - $total).' elba2y';
     
    if($interval){
      echo '<div id="message" class="overlay">
  <div class="popup">
    <h2>  '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
    <div class="content"> Now you have 
       ( '.($elba2y = $Annuel_days - $total).' ) Annual days
    </div>
  </div>
</div>';

echo '<script>
        swal({
        title: "Done",
  icon: "success",
  })
     </script>';}
  }
}

if($type == "Maternity Leave"  || $type == "Compassionate Leave"  || 
    $type == "Sick Leave" || $type == "Paternity Leave" && $interval !== "0" ){

if (file_exists($target_file)) {
     echo '<div id="message7" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;The file is already exists..
    </div>
  </div>
</div>
';
    $uploadOk == 0;
}
// Check file size
if ($_FILES["fileToUpload"]["size"] > 1000000) {
 echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;Your file is too large...
    </div>
  </div>
</div>';

    //$insert_query === 0;
 $uploadOk == 0;
}
// Allow certain file formats
if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg" && $imageFileType != "zip"
&& $imageFileType != "gif" && $imageFileType != "csv" && $imageFileType != "xlsx" && $imageFileType != "pdf" 
&& $imageFileType != "msg") {
    echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;&#9760;Only JPG, JPEG, PNG , GIF , csv & xlsx files are allowed...
    </div>
  </div>
</div>';
    //$insert_query === 0;
}
else
{
    $uploadOk == 0;
}
if ((move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) && $uploadOk !== 0 ) {
         '<div id="message" class="overlay">
  <div class="popup">
    <h2> Thanks'.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       The file '. basename( $_FILES["fileToUpload"]["name"]). ' has been uploaded.
    </div>
  </div>
</div>';
    } else {
        echo '<div id="message6" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;There is an error uploading your file...
    </div>
  </div>
</div>';
  $uploadOk == 0;
    }
}
/////end file upload file
 if($interval == 0 ) {
  echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;Your Operation Couldn`t be completed...
    </div>
  </div>
</div>';
}

elseif($type == "Maternity Leave"  || $type == "Compassionate Leave"  ||
    $type == "Sick Leave" || $type == "Paternity Leave" && $interval !== "0" ){

if ($uploadOk != 0)
  {
  $insert_query = sqlsrv_query( $con ,"INSERT INTO leaves ([username] , [engineer_id] , [adate] , [bdate] , [starttime] , [endtime] , [type] , [notes] , [count] , [status] , [creation_time]
    ,[attach] , [attach_image]) VALUES
     ('$s_username', '$engineer_id' , '$adate' , '$bdate' , '$starttime' , '$endtime' , '$type', '$notes' 
    , '$interval' , '$status' , '$sqltime','$target_file','$target_file' )");
  if($insert_query){
echo '<script>
        swal({
        title: "Done",
  icon: "success",
  })
     </script>';}
  }


if ($uploadOk == 0) {
  echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;Your file was not uploaded...
    </div>
  </div>
</div>';
   
}

}

// Unpaid leave
if($type == 'Unpaid Leave')
{
 $s_username = $_SESSION['username'];
 $engineer_id = $_SESSION['id'];

$unpaid_query = sqlsrv_query( $con ,"SELECT sum([count]) as countUnpaid FROM leaves WHERE ( status  = 'E-workforce and senior approve' or status = 'PENDING') AND [username] = '". $s_username."' and YEAR([adate]) = ".$CurrentYear." and YEAR([bdate]) = ".$CurrentYear." and [type] = 'Unpaid Leave'");
//php -> output data from mysqli
  while($output_unpaid = sqlsrv_fetch_array($unpaid_query)){
    $countUnpaid = $output_unpaid["countUnpaid"];
  }
   // if less than 21
  if($countUnpaid+$interval  > 5) {
    echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760;Your Operation Couldn`t be completed because you exceed the 5 days (Unpaid Leave)...
    </div>
  </div>
</div>';

  }

   else
  {
    $insert = sqlsrv_query( $con ,"INSERT INTO leaves ([username] , [engineer_id] , [adate] , [bdate] ,[starttime] , [endtime] , [type] , [notes] , [count] , [status] , [creation_time]) VALUES ('$s_username','$engineer_id' , '$adate' , '$bdate' , '$starttime' , '$endtime' , '$type', '$notes' , '$interval' , '$status' , '$sqltime' )");
    if($insert){
echo '<script>
        swal({
        title: "Done",
  icon: "success",
  })
     </script>';}else{
        echo '<script>
        swal({
        title: "Error",
  icon: "Wornning",
  })
     </script>';

     }
  }
}
//Sick Leave

if($type == 'Sick Leave')
{

  $first_query = sqlsrv_query( $con ,"SELECT sum([count]) as countLeaves FROM leaves WHERE [username] = '". $s_username."' and YEAR([adate]) = ".$CurrentYear." and YEAR([bdate]) = ".$CurrentYear." 
    and [type] = 'Sick Leave' 
  and ( status  = 'E-workforce and senior approve' or status = 'pending' or status = 'senior approve' )");

//php -> output data from mysqli
  while($output_query = sqlsrv_fetch_array($first_query )){
    $countLeaves = $output_query["countLeaves"];
  }
  //($countLeaves+$interval  >10)
  if(($countLeaves > 10) && ($type == 'Sick Leave'))
  {
    echo '<div id="message5" class="overlay">
  <div class="popup">
    <h2> Sorry '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       You have exceeded the 10 days sick leaves, so your salary will be affected
    </div>
  </div>
</div>';

  }
}
//$type !== "Sick Leave" && $type !== "Paternity Leave"
if($type !== 'Annual Leave' && $type !== 'Sick Leave'  && $type !== 'Permission'  && $type !== 'Compassionate Leave'
&& $type !== 'Paternity Leave' && $type !== 'Unpaid Leave' && $type !== "Maternity Leave"  ){

$insert_query = sqlsrv_query( $con ,"INSERT INTO leaves ([username] , [engineer_id] , [adate] , [bdate] , [starttime] , [endtime] , [type] , [notes] , [count] , [status] , [creation_time]) VALUES ('$s_username', '$engineer_id' , '$adate' , '$bdate' , '$starttime' , '$endtime' , '$type', '$notes' , '$interval' , '$status' , '$sqltime' )");

if($insert_query){
echo '<script>
        swal({
        title: "Done",
  icon: "success",
  })
     </script>';}else{
        echo '<script>
        swal({
        title: "Error",
  icon: "Wornning",
  })
     </script>';

     }
}
 
}
if(isset($_POST['send'])){
if(isset($_POST['type'])){$type = $_POST['type'];}
if(isset($_POST['adate'])){$adate = $_POST['adate'];}
  if(isset($_POST['bdate'])){$bdate = $_POST['bdate'];}
  if(isset($_POST['starttime'])){$starttime = $_POST['starttime'];}
  if(isset($_POST['endtime'])){$endtime= $_POST['endtime'];}
   $s_username = $_SESSION['username'];

$qryshift =  sqlsrv_query( $con ,"SELECT [shift_start]
  FROM [Aya_Web_APP].[dbo].[schedule_table]
  where username = '$s_username' and schedule_date = '$adate' " );

while($output_queryshift = sqlsrv_fetch_array($qryshift)){
  $resshift_start = $output_queryshift['shift_start'];
}

if($type == 'Permission'){

  $CurrentYear = date("Y",strtotime($adate));
  $CurrentMonth = date("m",strtotime($adate));
  $NextYear = date("Y", strtotime('+1 month',strtotime($adate)));
  $NextMonth = date("m", strtotime('+1 month',strtotime($adate)));

if (date("d",strtotime($adate)) < 14 ) {
  $CurrentYear = date("Y",strtotime('-1 month',strtotime($adate)));
  $CurrentMonth = date("m",strtotime('-1 month',strtotime($adate)));

  $NextYear = date("Y", strtotime($adate));
  $NextMonth = date("m", strtotime($adate));
}
else
{
  $CurrentYear = date("Y",strtotime($adate));
  $CurrentMonth = date("m",strtotime($adate));

  $NextYear = date("Y", strtotime('+1 month',strtotime($adate)));
  $NextMonth = date("m", strtotime('+1 month',strtotime($adate)));
}
$today = date("Y-m-d"); // 2012-01-30
$next_month = date("Y-m-d", strtotime("$today +1 month"));
$diff = abs(strtotime($bdate) - strtotime($adate));
$new_date = date_format(date_create($adate), 'Y-m-d');
$new_time = date('H:i:s', strtotime($starttime));

$new_dateto = date_format(date_create($bdate), 'Y-m-d');
//$new_timeto = time_format(time_create($endtime), 'Y-m-d H:i:s');
$new_timeto = date('H:i:s', strtotime($endtime));

    $fdatetime = strtotime( $adate ." ".$starttime )  ; 
    $tdatetime = strtotime($bdate ." ". $endtime); 

    if (strtotime($adate.' '.$resshift_start) == strtotime($adate.' '.$starttime)  ) {
      $fdatetime = $fdatetime + 900 ;
    }

    // Formulate the Difference between two dates 
  $diff = abs($tdatetime - $fdatetime) ;

  $diffMinutes = $diff / 60 ;   // transform to minutes 


  if ($diffMinutes /60 > 4){   //// check if exceed 4 hours 
 echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Attention '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       #x26A0; You created more than 4 hours
    </div>
  </div>
</div>';


// message exceed 4 hours    
  }
if($diffMinutes < 15 ){
  echo 
  '<div id="message" class="overlay">
  <div class="popup">
    <h2> Attention '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       Wornning:Permission must be > 15M
    </div>
  </div>
</div>';

}
  else{
   
    $units =  $diffMinutes ;

$qryUnits =  sqlsrv_query( $con ,"SELECT sum([count]) as countUnits
  FROM [Aya_Web_APP].[dbo].[leaves]
  where adate >= '".$CurrentYear."-".$CurrentMonth."-15 00:00:00' and bdate <= '".$NextYear."-".$NextMonth."-14 23:59:00' 
  and username = '$s_username' and type = 'Permission'
  and ( status  = 'E-workforce and senior approve' or status = 'PENDING' or status ='senior approve')" );

while($output_queryU = sqlsrv_fetch_array($qryUnits)){
  $resUnits = $output_queryU['countUnits'];
}

if($resUnits + $units > 240)
{
 /// messge 
 echo '<div id="message" class="overlay">
  <div class="popup">
    <h2> Attention '.$s_username.'</h2>
    <span class="deleteMeetingClose">&times;</span>
<br/>
    <div class="content">
       &#9760; You exceed 4 hours
    </div>
  </div>
</div>';

}
else
{
//insert query +  units 
  $time_query = sqlsrv_query( $con ,"INSERT INTO leaves ([username] , [engineer_id] , [adate] , [bdate] , [starttime] , [endtime] , [type],[notes],[count] , [status] , [creation_time]) VALUES ('$s_username','$engineer_id','$adate','$bdate','$starttime','$endtime','$type','$notes','$units' , '$status' , '$sqltime' )");

if($time_query){
echo '<script>
        swal({
        title: "Done",
  icon: "success",
  })
     </script>';}else{
        echo '<script>
        swal({
        title: "Error",
  icon: "Wornning",
  })
     </script>';

     }


}
}
}
}}
?>

</div>
</form>
</section>

<!--center>
<div class="limiter">
    <div class="container-table100">
      <div class="tableFixHead col-8">

<table class="order-table" cellspacing="0"id="tblCustomers" style="border-radius:30px 30px 30px 30px;background-color: #fff;" >
  <thead  style="color: white; font-weight: bold; text-align: center;font-size: 15px; "-->

        <center>
      <div class="col-md-8">
        <div class="tableFixHead" >
           <table style="border-radius: 30px 30px 0 0;">
        <thead >
        <tr>
          <th ><center>Type </center></th>
          <th ><center>From date</center></th>
          <th ><center>To date</center></th>
          <th ><center>From time</center></th>
          <th ><center>To time</center></th>
          <th ><center>Notes  </center></th>
          <th ><center>Count </center></th>
          <th ><center>Status</center></th>
          <th ><center>Attach</center></th>
    </tr>
    </thead>
  <tbody style="background-color:white;">

<?php 
$s_username = $_SESSION['username'];
$first_query = sqlsrv_query( $con ,"SELECT * FROM leaves WHERE username ='$s_username' order by [creation_time] DESC ");
while($output_query = sqlsrv_fetch_array($first_query)){
$rows  ='<tr >';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["type"].'</canter></td>';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["adate"]->format('Y-m-d').'</canter></td>';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["bdate"]->format('Y-m-d').'</canter></td>';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["starttime"]->format('H:i:s').'</canter></td>';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["endtime"]->format('H:i:s').'</canter></td>';
$rows .='<td class="cell100 column1 hovers" style="font-size:11px"><center>'.$output_query["notes"].'</canter></td>';
$rows .='<td class="cell100 column1 hovers"><center>'.$output_query["count"]. '</canter></td>';
$rows .='<td class="cell100 column1 hovers" style="color:green;"><canter>'.$output_query["status"].'</canter></td>';
if(($output_query["attach"] !== "uploads/") && ($output_query["attach"] !== " ") && ($output_query["type"] == "Sick Leave"  || $output_query["type"] == "Compassionate Leave"  || 
    $output_query["type"] == "Maternity Leave" || $output_query["type"] == "Paternity Leave")){
$rows .= '<td  class="cell100 column1 pt-3-half hovers" ><center><a href='.$output_query["attach_image"].' download><samp style="float:center;font-size:25px;"><i class="fa fa-paperclip hovers" style="color:orange;"></samp></i></a>'.'</canter></td>';
}
else{
  $rows .= '<td class="hovers"></td>';}

$rows .='</tr>';

echo $rows;
}
  ?>

              </tbody>
            </table>
          </div>
        </div>        
     
</center>




<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
     <!-- Popper.JS -->
<script type="text/javascript">
  function myfunc(){
    var start = new Date($('#adate').val());
    var end = new Date($('#bdate').val());

// end - start returns difference in milliseconds 
var diff = new Date(end - start);

// get days
var days = diff/1000/60/60/24;
days = days+1
$('#countDays').val(Math.round(days));
    alert(Math.round(days));
}

</script>
<script type="text/javascript">
  if($('#inputGroupSelect01').value != "Permission" && $('#inputGroupSelect').value != "Official Mission")
  {
    $('#ToTimeDiv').hide();
    $('#FromTimeDiv').hide(); 
  }
  $('#inputGroupSelect01').on('change' , function(){
    //alert(this.value);
    if(this.value == "Permission" || this.value == "Official Mission"){

      $('#ToTimeDiv').show();
      $('#FromTimeDiv').show();
    }
else{
  $('#ToTimeDiv').hide();
  $('#FromTimeDiv').hide();  
}
});
</script>

    <script type="text/javascript">
  if($('#inputGroupSelect01').value != "Permission" && $('#inputGroupSelect').value != "Official Mission")
  {
    
    $('#upload').hide(); 
  }
  $('#inputGroupSelect01').on('change' , function(){
    //alert(this.value);
    if(this.value == "Sick Leave" || this.value == "Compassionate Leave" || this.value == "Maternity Leave"|| this.value == "Paternity Leave"){

      $('#upload').show();
    }
else{
  $('#upload').hide();
}
});
</script>

<script type="text/javascript">
  function validateForm() {
  var x, adate;
  var y, bdate;

  // Get the value of the input field with id="numb"
  x = document.getElementById("numb").value;

  // If x is Not a Number or less than one or greater than 10
  if (isNaN(x) || x < 1 || x > 10) {
    text = "Input not valid";
  } else {
    text = "Input OK";
  }
  document.getElementById("demo").innerHTML = text;
}

function compare()
{
  debugger;
    var startDt = document.getElementById("adate").value;
    var endDt = document.getElementById("bdate").value;
    var ptype = document.getElementById("inputGroupSelect01").value;

    var strStartTime = document.getElementById("starttime").value;
    var strEndTime = document.getElementById("endtime").value;

    var startTime = new Date().setHours(GetHours(strStartTime), GetMinutes(strStartTime), 0);
    var endTime = new Date(startTime)
    endTime = endTime.setHours(GetHours(strEndTime), GetMinutes(strEndTime), 0);

    if( (startTime > endTime) && (ptype == "Permission" || ptype == "Official Mission" ) ) {
        alert("Start Time is greater than end time");
        event.preventDefault();
    }

function GetHours(d) {
    var h = parseInt(d.split(':')[0]);
    if (d.split(':')[1].split(' ')[1] == "PM") {
        h = h + 12;
    }
    return h;
}
function GetMinutes(d) {
    return parseInt(d.split(':')[1].split(' ')[0]);
}
/////////

  if( (new Date(startDt).getTime() > new Date(endDt).getTime()))
    {
       alert("To Date should be greater than From date ");
       event.preventDefault();
    }
  if( (new Date(startDt).getTime() != new Date(endDt).getTime())  && (ptype == "Permission" || 
  ptype == "Official Mission" ) )
  {
      alert("To Date should be equal From date ");
       event.preventDefault();
  }   
}
</script>


<script type="text/javascript">
  function myfunc(){
    var start = new Date($('#adate').val());
    var end = new Date($('#bdate').val());

// end - start returns difference in milliseconds 
var diff = new Date(end - start);

// get days
var days = diff/1000/60/60/24;
days = days+1
$('#countDays').val(Math.round(days));
    alert(Math.round(days));
}

</script>
<script type="text/javascript">
  if($('#inputGroupSelect01').value != "Permission" && $('#inputGroupSelect').value != "Official Mission")
  {
    $('#ToTimeDiv').hide();
    $('#FromTimeDiv').hide(); 
  }
  $('#inputGroupSelect01').on('change' , function(){
    //alert(this.value);
    if(this.value == "Permission" || this.value == "Official Mission"){

      $('#ToTimeDiv').show();
      $('#FromTimeDiv').show();
    }
else{
  $('#ToTimeDiv').hide();
  $('#FromTimeDiv').hide();  
}
});
</script>
<script type="text/javascript">
  (function() {
  document.getElementById("message").style.display = 'none';
});

  $('#overlay, .deleteMeetingCancel, .deleteMeetingClose').click(function () {
    //close action
    document.getElementById("message").style.display = 'none';
});
</script>


<script type="text/javascript">
  (function() {
  document.getElementById("message7").style.display = 'none';
});

  $('#overlay, .deleteMeetingCancel, .deleteMeetingClose').click(function () {
    //close action
    document.getElementById("message7").style.display = 'none';
});
</script>

<script type="text/javascript">
  (function() {
  document.getElementById("message5").style.display = 'none';
});

  $('#overlay, .deleteMeetingCancel, .deleteMeetingClose').click(function () {
    //close action
    document.getElementById("message5").style.display = 'none';
});
</script>
<script type="text/javascript">
  (function() {
  document.getElementById("message6").style.display = 'none';
});

  $('#overlay, .deleteMeetingCancel, .deleteMeetingClose').click(function () {
    //close action
    document.getElementById("message6").style.display = 'none';
});
</script>


<script type="text/javascript">
  (function() {
  document.getElementById("message1").style.display = 'none';
});

  $('#overlay, .deleteMeetingCancel, .deleteMeetingClose').click(function () {
    //close action
    document.getElementById("message1").style.display = 'none';
});
</script>
<?php

 include ("footer.html");
 ?>
